<!-- Sidebar -->
<aside id="crb_sidebar"
       class="crb_sidebar transition-all duration-300 ease-in-out overflow-hidden"
       :class="$store.sidebar.expanded ? 'w-72' : 'w-20'"
       x-show="!$store.sidebar.hidden">

    <!-- Logo & Header -->
    <div :class="$store.sidebar.expanded
        ? 'flex flex-row items-center justify-between p-6'
        : 'flex flex-col items-center p-6 gap-2'"
        class="border-b border-slate-700/50 transition-all duration-300">

        <!-- Left: Logo + App name -->
        <div class="flex items-center gap-3 cursor-pointer"
             @click="window.location.href='./'">

            <!-- Logo -->
            <img alt="Logo"
                 :src="$store.sidebar.expanded
                ? $store.branding.logo.expanded
                : $store.branding.logo.collapsed"
                 :style="`
                width: ${$store.sidebar.expanded
                    ? $store.branding.size.expanded.width
                    : $store.branding.size.collapsed.width}px;
                height: ${$store.sidebar.expanded
                    ? $store.branding.size.expanded.height
                    : $store.branding.size.collapsed.height}px;
             `"
                 class="transition-all duration-300 object-contain"/>

            <!-- App name (only expanded) -->
            <span x-show="$store.sidebar.expanded && $store.branding.showAppName"
                  x-transition.opacity.duration.200ms
                  class="font-bold text-xl tracking-tight whitespace-nowrap"
                  x-text="$store.branding.appName">
        </span>
        </div>

        <!-- Burger menu -->
        <button @click="$store.sidebar.toggleSidebar()"
                x-transition.opacity.scale.duration.200ms
                class="p-2 h-8 rounded-lg hover:bg-slate-700/50 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg"
                 :class="$store.sidebar.expanded ? 'h-5 w-5' : 'h-4 w-4'"
                 fill="none"
                 viewBox="0 0 24 24"
                 stroke="currentColor">
                <path stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>
    </div>

    <!-- Workspace -->
    <div class="items-center justify-between p-6 border-b border-slate-700/50"
         x-data="workspaceSelector()"
         x-init="init()"
         @click.outside="close()">

        <!-- Label + Boutons -->
        <div x-show="$store.sidebar.expanded"
             class="flex items-center justify-between mb-2"
             x-transition.opacity.duration.200ms>
            <label class="text-xs text-slate-400" x-text="$store.labels.getLabel('header','workspace')"></label>

            <!-- Boutons Select All / None -->
            <div x-show="open" class="flex gap-2">
                <button type="button" class="text-[10px] px-2 py-0.5 rounded bg-slate-700 hover:bg-slate-600 text-slate-300"
                        id="header_workspaceOpen_selectAll" @click="selectAll()">All
                </button>
                <button type="button" class="text-[10px] px-2 py-0.5 rounded bg-slate-700 hover:bg-slate-600 text-slate-300"
                        id="header_workspaceOpen_selectNone" @click="selectNone()">None
                </button>
            </div>
        </div>

        <!-- Combobox Sidebar Open -->
        <div x-show="$store.sidebar.expanded" x-transition.opacity.duration.200ms class="relative">
            <button id="header_workspaceOpen_showList" type="button" @click="toggleOpen()"
                    class="flex h-10 items-center justify-between w-full rounded-md border px-3 py-2 text-sm
                   bg-slate-800 border-slate-600 text-slate-300 hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500/30 transition-all">
                <div class="flex items-center gap-2">
                    <!-- Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                         fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M3 7a2 2 0 012-2h5l2 2h7a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/>
                    </svg>
                    <span x-text="selectedLabel()"></span>
                </div>
            </button>

            <!-- Dropdown Sidebar Open -->
            <div x-show="open" x-transition
                 class="mt-1 w-full max-h-[400px] overflow-auto rounded-md border border-slate-600 bg-slate-800 shadow-lg absolute z-50">
                <!-- Barre de recherche -->
                <div class="p-2 border-b border-slate-600">
                    <input type="text" id="header_workspaceOpen_search"
                           x-model="search"
                           placeholder="Rechercher..."
                           class="w-full rounded-md bg-slate-700 text-slate-200 text-sm px-3 py-2
                          focus:outline-none focus:ring-2 focus:ring-blue-500/30">
                </div>
                <ul class="py-1 text-sm text-slate-300">
                    <template x-for="workspace in filteredWorkspaces()" :key="workspace">
                        <li>
                            <button type="button"
                                    :id="'header_workspaceOpen_item_' + workspace.replace(/\s+/g, '_').toLowerCase()"
                                    @click.stop="toggle(workspace)"
                                    class="w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 transition-colors">
                                <svg x-show="selected.includes(workspace)" xmlns="http://www.w3.org/2000/svg"
                                     class="h-4 w-4 text-blue-500" fill="none" viewBox="0 0 24 24"
                                     stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                </svg>
                                <span x-text="workspace"></span>
                            </button>
                        </li>
                    </template>
                    <template x-if="filteredWorkspaces().length === 0">
                        <li class="px-3 py-2 text-slate-500 italic">Aucun résultat</li>
                    </template>
                </ul>
            </div>
        </div>

        <!-- Combobox Sidebar Closed -->
        <div x-show="!$store.sidebar.expanded" x-transition.opacity.duration.200ms
             class="relative group w-10 h-10">
            <div class="flex items-center justify-center w-8 h-8 text-slate-300 text-xs cursor-pointer"
                 @click="toggleOpen()">
                <!-- Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 7a2 2 0 012-2h5l2 2h7a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/>
                </svg>
            </div>

            <!-- Badge Selected Number -->
            <div x-show="selected.length > 0"
                 class="absolute bottom-0 right-0 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                <span x-text="selected.length"></span>
            </div>

            <!-- Dropdown Sidebar Closed (téléporté) -->
            <template x-if="!$store.sidebar.expanded">
            <template x-teleport="body">
                <div x-show="open" x-transition
                     class="mt-1 w-80 max-h-[400px] overflow-auto rounded-md border border-slate-600 bg-slate-800 shadow-lg absolute z-[9999] ml-20"
                     :style="{
                     top: $root.querySelector('.group').getBoundingClientRect().top + 'px'
                 }">
                    <ul class="py-1 text-sm text-slate-300">
                        <template x-for="workspace in workspaces" :key="workspace">
                            <li>
                                <button type="button"
                                        @click.stop="toggle(workspace)"
                                        class="w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 transition-colors">
                                    <svg x-show="selected.includes(workspace)" xmlns="http://www.w3.org/2000/svg"
                                         class="h-3 w-3 text-blue-500" fill="none" stroke="currentColor"
                                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 6 9 17l-5-5"></path>
                                    </svg>
                                    <span x-text="workspace"></span>
                                </button>
                            </li>
                        </template>
                    </ul>
                </div>
            </template>
            </template>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-4 py-6 space-y-3 overflow-y-auto overflow-x-visible">

        <!-- Automate -->
        <div class="space-y-2" id="navMenuAutomate">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('automate')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'automate')"
                        @mouseleave="$store.sidebar.leaveMenu('automate')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                        <i data-lucide="test-tube" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                        <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','automate')"></span>
                        <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                        :class="$store.sidebar.activeMenu === 'automate' ? 'rotate-90' : ''"
                        class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'automate'"
                     class="ml-12 space-y-1"
                     x-ref="automateMenuInline"
                     x-html="$refs.automateMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.automateMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.automate"
                         :style="$store.sidebar.showSubMenu.automate ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('automate')"
                         @mouseleave="$store.sidebar.leaveSubMenu('automate')"
                         x-ref="automateMenuTeleport"
                         x-html="$refs.automateMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.automateMenuTeleport))">
                    </div>
                </template>

                <template x-ref="automateMenuItems">
                    <a href="QuickStart.jsp" id="menuTestCaseCreate" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'QuickStart.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="zap" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','quickstart')"></span>
                    </a>

                    <a href="#" id="menuImportTestcase" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="library" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','import')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="#" id="menuTestDesigner" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="library" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','testdesigner')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                </template>
            </div>
        </div>

        <!-- Maintain -->
        <div class="space-y-2" id="navMenuMaintain">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('maintain')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'maintain')"
                        @mouseleave="$store.sidebar.leaveMenu('maintain')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="wrench" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','maintain')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'maintain' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                    </svg>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'maintain'"
                     class="ml-12 space-y-1"
                     x-ref="maintainMenuInline"
                     x-html="$refs.maintainMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.maintainMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.maintain"
                         :style="$store.sidebar.showSubMenu.maintain ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('maintain')"
                         @mouseleave="$store.sidebar.leaveSubMenu('maintain')"
                         x-ref="maintainMenuTeleport"
                         x-html="$refs.maintainMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.maintainMenuTeleport))">
                    </div>
                </template>

                <template x-ref="maintainMenuItems">
                    <a href="TestCaseList.jsp" id="menuTestCaseList" class="group flex items-center gap-2 px-4 py-2 text-xs  rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'TestCaseList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="layout-list" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','testcases')"></span>
                    </a>

                    <a href="#" id="menuStepLibrary" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="library" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400">Step Library</span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="TestDataLibList.jsp" id="menuTestDataLib" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'TestDataLibList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="database-backup" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','datalibrary')"></span>
                    </a>

                    <a href="ApplicationObjectList.jsp" id="menuApplicationObjects" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ApplicationObjectList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="library" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','applicationobjects')"></span>
                    </a>

                    <a href="AppServiceList.jsp" id="menuAppService" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'AppServiceList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="globe" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','appservice')"></span>
                    </a>

                    <a href="Label.jsp" id="menuLabel" class="group flex items-center gap-2 px-4 py-2 text-xs  rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'Label.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="tag" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','label')"></span>
                    </a>

                    <a href="ImpactAnalysis.jsp" id="menuImpactAnalysis" class="group flex items-center gap-2 px-4 py-2 text-xs  rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ImpactAnalysis.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="scan-search" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','impactanalysis')"></span>
                    </a>
                </template>
            </div>
        </div>

        <!-- Execute -->
        <div class="space-y-2" id="navMenuExecute">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('execute')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'execute')"
                        @mouseleave="$store.sidebar.leaveMenu('execute')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="play" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','execute')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'execute' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'execute'"
                     class="ml-12 space-y-1"
                     x-ref="executeMenuInline"
                     x-html="$refs.executeMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.executeMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.execute"
                         :style="$store.sidebar.showSubMenu.execute ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('execute')"
                         @mouseleave="$store.sidebar.leaveSubMenu('execute')"
                         x-ref="executeMenuTeleport"
                         x-html="$refs.executeMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.executeMenuTeleport))">
                    </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="executeMenuItems">
                    <a href="RunTests.jsp" id="menuRunTestCase" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'RunTests.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="square-play" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','runtestcase')"></span>
                    </a>

                    <a href="#" id="menuScheduledRun" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 bg-slate-700/20 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="library" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','scheduledrun')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="RobotList.jsp" id="menuRobot" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'RobotList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="monitor-play" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','robot')"></span>
                    </a>

                    <a href="CampaignList.jsp" id="menuTestCampaign" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'CampaignList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="group" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','campaign')"></span>
                    </a>
                    <a href="TestCaseExecutionQueueList.jsp" id="menuRunTestSeePendingExecution" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'TestCaseExecutionQueueList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="list-end" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','executioninqueue')"></span>
                    </a>
                </template>
            </div>
        </div>

        <!-- Monitor -->
        <div class="space-y-2" id="navMenuMonitor">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('monitor')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'monitor')"
                        @mouseleave="$store.sidebar.leaveMenu('monitor')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" id="menuMonitor" x-text="$store.labels.getLabel('header','monitor')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'monitor' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'monitor'"
                     class="ml-12 space-y-1"
                     x-ref="monitorMenuInline"
                     x-html="$refs.monitorMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.monitorMenuInline))">
                </div>

                <!-- Sous-menu téléporté (sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.monitor"
                         :style="$store.sidebar.showSubMenu.monitor ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('monitor')"
                         @mouseleave="$store.sidebar.leaveSubMenu('monitor')"
                         x-ref="monitorMenuTeleport"
                         x-html="$refs.monitorMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.monitorMenuTeleport))">
                    </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="monitorMenuItems">

                    <a href="#" id="menuMonitorAutomate" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="chart-column" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','monitorautomate')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="ReportingMonitor.jsp" id="menuReportingMonitor" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ReportingMonitor.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="activity" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','monitorrealtime')"></span>
                    </a>

                    <a href="#" id="menuWebMonitor" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="globe" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','monitorweb')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="#" id="menuMobileMonitor" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="smartphone" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','monitormobile')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                    <a href="#" id="menuApiMonitor" @click.prevent class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 opacity-70"
                       :title="$store.labels.getLabel('header','soon')">
                        <i data-lucide="plug" class="w-4 h-4 text-slate-500"></i>
                        <span class="text-slate-400" x-text="$store.labels.getLabel('header','monitorapi')"></span>
                        <i data-lucide="clock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                    </a>

                </template>
            </div>
        </div>

        <!-- Insights -->
        <div class="space-y-2" id="navMenuInsights">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('insights')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'insights')"
                        @mouseleave="$store.sidebar.leaveMenu('insights')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="app-window" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','insights')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'insights' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'insights'"
                     class="ml-12 space-y-1"
                     x-ref="insightsMenuInline"
                     x-html="$refs.insightsMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.insightsMenuInline))"
                ></div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.insights"
                         :style="$store.sidebar.showSubMenu.insights ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('insights')"
                         @mouseleave="$store.sidebar.leaveSubMenu('insights')"
                         x-ref="insightsMenuTeleport"
                         x-html="$refs.insightsMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.insightsMenuTeleport))"
                    ></div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="insightsMenuItems">

                    <!-- ROLE AS : accès autorisé -->
                    <template x-if="$store.user.data.group.includes('AS')">
                        <a href="ReportingAutomateScore.jsp" id="menuReportingAutomateScore"
                           class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                           :class="$store.sidebar.activeSubmenu === 'ReportingAutomateScore.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                            <i data-lucide="target" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                            <span class="text-white" x-text="$store.labels.getLabel('header','automatescore')"></span>
                        </a>
                    </template>

                    <!-- PAS LE ROLE AS : visible mais désactivé -->
                    <template x-if="!$store.user.data.group.includes('AS')">
                        <a href="#" id="menuReportingAutomateScoreDisabled" @click.prevent
                           class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg cursor-not-allowed text-slate-500 bg-slate-700/20 opacity-70"
                           :title="$store.labels.getLabel('header','missingroleas')">
                            <i data-lucide="ban" class="w-4 h-4 text-slate-500"></i>
                            <span class="text-slate-400" x-text="$store.labels.getLabel('header','automatescore')"></span>
                            <i data-lucide="lock" class="w-3 h-3 text-amber-400 opacity-80"></i>
                        </a>
                    </template>

                    <a href="TestCaseExecutionList.jsp" id="menuReportingExecutionList" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'TestCaseExecutionList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="list-video" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','executionhistory')"></span>
                    </a>

                    <a href="ReportingExecutionOverTime.jsp" id="menuReportingExecutionOverTime" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ReportingExecutionOverTime.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="trending-up" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','executiontrends')"></span>
                    </a>

                    <a href="ReportingExecutionByTag.jsp" id="menuReportingExecutionByTag" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ReportingExecutionByTag.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="tag" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','campaignreport')"></span>
                    </a>

                    <a href="ReportingCampaignOverTime.jsp" id="menuReportingCampaignOverTime" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ReportingCampaignOverTime.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="tags" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','campaignhistory')"></span>
                    </a>

                    <a href="ReportingCampaignStatistics.jsp" id="menuReportingCampaignStatistics" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ReportingCampaignStatistics.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="chart-column" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','campaigntrends')"></span>
                    </a>

                </template>
            </div>
        </div>

        <!-- Settings -->
        <div class="space-y-2" id="navMenuSettings">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('settings')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'settings')"
                        @mouseleave="$store.sidebar.leaveMenu('settings')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="sliders" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','settings')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'settings' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'settings'"
                     class="ml-12 space-y-1"
                     x-ref="settingsMenuInline"
                     x-html="$refs.settingsMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.settingsMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.settings"
                         :style="$store.sidebar.showSubMenu.settings ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('settings')"
                         @mouseleave="$store.sidebar.leaveSubMenu('settings')"
                         x-ref="settingsMenuTeleport"
                         x-html="$refs.settingsMenuItems.innerHTML"
                    x-effect="$nextTick(() => lucide.createIcons($refs.settingsMenuTeleport))">
                </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="settingsMenuItems">

                    <a href="ApplicationList.jsp" id="menuApplications" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ApplicationList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="dock" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','applicationlist')"></span>
                    </a>

                    <a href="Environment.jsp" id="menuEnvironments" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'Environment.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="container" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','environments')"></span>
                    </a>

                </template>
            </div>
        </div>

        <!-- Admin -->
        <div class="space-y-2" id="navMenuAdmin"
             x-show="$store.user.data.group.includes('Administrator')">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('admin')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'admin')"
                        @mouseleave="$store.sidebar.leaveMenu('admin')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="cog" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','admin')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'admin' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'admin'"
                     class="ml-12 space-y-1"
                     x-ref="adminMenuInline"
                     x-html="$refs.adminMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.adminMenuInline))">

                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.admin"
                         :style="$store.sidebar.showSubMenu.admin ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('admin')"
                         @mouseleave="$store.sidebar.leaveSubMenu('admin')"
                         x-ref="adminMenuTeleport"
                         x-html="$refs.adminMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.adminMenuTeleport))">
                    </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="adminMenuItems">
                    <a href="UserManager.jsp" id="menuUsersManager" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'UserManager.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="user" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','usersmanager')"></span>
                        <span x-show="!$store.user.data.group.includes('Administrator')">Ask</span>
                    </a>
                    <a href="LogEvent.jsp" id="menuLogViewer" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'LogEvent.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="receipt-text" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','logviewer')"></span>
                    </a>
                    <a href="DatabaseMaintenance.jsp" id="menuDatabaseMaintenance" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'DatabaseMaintenance.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="database-backup" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','databasemaintenance')"></span>
                    </a>
                    <a href="ParameterList.jsp" id="menuParameter" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'ParameterList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="cog" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','parameter')"></span>
                    </a>
                    <a href="InvariantList.jsp" id="menuInvariants" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'InvariantList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="text-select" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','invariants')"></span>
                    </a>
                    <a href="CerberusInformation.jsp" id="menuReportingExecutionThreadMonitoring" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'CerberusInformation.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="info" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','monitoring')"></span>
                    </a>
                </template>
            </div>
        </div>

        <!-- Developer -->
        <div class="space-y-2" id="navMenuDev">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('developer')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'developer')"
                        @mouseleave="$store.sidebar.leaveMenu('developer')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="code" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','dev')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'developer' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'developer'"
                     class="ml-12 space-y-1"
                     x-ref="devMenuInline"
                     x-html="$refs.developerMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.devMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.developer"
                         :style="$store.sidebar.showSubMenu.developer ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('developer')"
                         @mouseleave="$store.sidebar.leaveSubMenu('developer')"
                         x-ref="devMenuTeleport"
                         x-html="$refs.developerMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.devMenuTeleport))">
                    </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="developerMenuItems">
                    <a href="SwaggerUI.jsp" id="menuSwagger" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'SwaggerUI.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="book-open-text" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','swagger')"></span>
                    </a>
                    <a href="EventHookList.jsp" id="menuEventhooks" class="group flex items-center gap-2 px-4 py-2 text-xs rounded-lg transition-colors"
                       :class="$store.sidebar.activeSubmenu === 'EventHookList.jsp' ? '!bg-blue-600 !text-white hover:!bg-blue-700' : '!text-slate-300 hover:bg-slate-700/30 hover:!text-white'">
                        <i data-lucide="webhook" class="w-4 h-4 text-slate-400 group-hover:!text-white transition-colors"></i>
                        <span class="text-white"  x-text="$store.labels.getLabel('header','eventhooks')"></span>
                    </a>
                </template>
            </div>
        </div>

        <!-- Help -->
        <div class="space-y-2" id="navMenuHelp">
            <div class="relative">
                <button @click="$store.sidebar.toggleActiveMenu('help')"
                        @mouseenter="$store.sidebar.enterMenu($event.currentTarget.getBoundingClientRect(), 'help')"
                        @mouseleave="$store.sidebar.leaveMenu('help')"
                        class="flex items-center w-full gap-4 px-4 py-3 rounded-xl hover:bg-slate-700/50 group transition-all duration-200 relative">
                    <i data-lucide="file-question-mark" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
                    <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','help')"></span>
                    <i data-lucide="chevron-right" x-show="$store.sidebar.expanded"
                       :class="$store.sidebar.activeMenu === 'help' ? 'rotate-90' : ''"
                       class="w-4 h-4 ml-auto transition-transform duration-200"></i>
                </button>

                <!-- Sous-menu inline (quand sidebar ouverte) -->
                <div x-cloak x-transition.opacity.duration.200ms
                     x-show="$store.sidebar.expanded && $store.sidebar.activeMenu === 'help'"
                     class="ml-12 space-y-1"
                     x-ref="helpMenuInline"
                     x-html="$refs.helpMenuItems.innerHTML"
                     x-effect="$nextTick(() => lucide.createIcons($refs.helpMenuInline))">
                </div>

                <!-- Sous-menu téléporté (quand sidebar fermée) -->
                <template x-teleport="body">
                    <div x-cloak x-transition.opacity.duration.300ms
                         x-show="!$store.sidebar.expanded && $store.sidebar.showSubMenu.help"
                         :style="$store.sidebar.showSubMenu.help ? 'position: fixed; top:' + $store.sidebar.hoverPos.top + 'px; left:5rem;' : 'display:none'"
                         class="crb_submenu bg-slate-800 rounded-lg shadow-lg p-2 space-y-1 min-w-[12rem] border border-slate-600"
                         @mouseenter="$store.sidebar.enterSubMenu('help')"
                         @mouseleave="$store.sidebar.leaveSubMenu('help')"
                         x-ref="helpMenuTeleport"
                         x-html="$refs.helpMenuItems.innerHTML"
                         x-effect="$nextTick(() => lucide.createIcons($refs.helpMenuTeleport))">
                    </div>
                </template>

                <!-- Template factorisé (non affiché directement) -->
                <template x-ref="helpMenuItems">
                    <a href="./documentation/D1/documentation_en.html" target="_blank" id="menuDocumentationD1" class="flex items-center gap-2 px-4 py-2 text-xs !text-slate-300 rounded-lg hover:text-white hover:!bg-slate-700/30 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span x-text="$store.labels.getLabel('header','documentationd1')"></span>
                    </a>
                    <a href="./documentation/D2/documentation_en.html" target="_blank" id="menuDocumentationD2" class="flex items-center gap-2 px-4 py-2 text-xs !text-slate-300 rounded-lg hover:text-white hover:!bg-slate-700/30 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span x-text="$store.labels.getLabel('header','documentationd2')"></span>
                    </a>
                    <a href="./documentation/D3/documentation_en.html" target="_blank" id="menuDocumentationD3" class="flex items-center gap-2 px-4 py-2 text-xs !text-slate-300 rounded-lg hover:text-white !hover:bg-slate-700/30 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span x-text="$store.labels.getLabel('header','documentationd3')"></span>
                    </a>
                    <button id="openInteractiveTutoModal" class="flex items-center gap-2 w-full text-left px-4 py-2 text-xs text-slate-300 rounded-lg hover:text-white hover:bg-slate-700/30 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h8m2-10v18l-4-4H6a2 2 0 01-2-2V4a2 2 0 012-2h12a2 2 0 012 2z"/>
                        </svg>
                        <span x-text="$store.labels.getLabel('header','interactivetuto')"></span>
                    </button>
                </template>
            </div>
        </div>

    </nav>
    <!-- Quick History Shortcut -->
    <div class="border-t border-slate-700 hover:bg-slate-700/50  sticky bottom-[4.5rem] z-50 px-4"
         x-data="quickHistoryMenu()"
         @mouseenter="open()"
         @mouseleave="close()">

        <!-- Bouton raccourci -->
        <div id="quick_history_button"
             class="flex items-center w-full gap-4 px-4 py-3 rounded-xl group transition-all duration-200 relative">
            <!-- Icône horloge -->
            <i data-lucide="clock" class="w-5 h-5 text-slate-400 group-hover:text-white transition-colors"></i>
            <span x-show="$store.sidebar.expanded" x-transition class="text-sm" x-text="$store.labels.getLabel('header','history')"></span>
        </div>

        <!-- Popin téléportée -->
        <template x-teleport="body">
            <div
                    x-bind="$data"
                    x-show="openMenu"
                    x-transition.opacity.duration.150ms
                    x-ref="dropdown"
                    class="fixed w-[900px] max-h-[420px]
                   rounded-xl border border-slate-600
                   bg-slate-800 text-white shadow-xl
                   overflow-hidden z-50"
                    @mouseenter="open()"
                    @mouseleave="close()"
            >

                <!-- Header -->
                <div class="px-5 py-3 border-b border-slate-700 font-semibold text-slate-300">
                    <span x-transition class="text-sm" x-text="$store.labels.getLabel('header','lastseen')"></span>
                </div>

                <!-- 3 colonnes -->
                <div class="grid grid-cols-3 divide-x divide-slate-700 max-h-[360px] overflow-auto">

                    <!-- Testcases -->
                    <div class="p-4 space-y-2">
                        <div class="text-xs font-semibold text-slate-400">
                            <span x-transition class="text-sm" x-text="$store.labels.getLabel('header','lastseentestcases')"></span>
                        </div>

                        <template x-for="tc in testcases" :key="tc.href">
                            <a :href="tc.href"
                               class="block px-2 py-1 !text-slate-300 rounded hover:bg-slate-700">
                                <div class="text-sm" x-text="tc.name"></div>
                                <div class="text-xs text-slate-400"
                                     x-show="tc.desc"
                                     x-text="tc.desc"></div>
                            </a>
                        </template>
                    </div>

                    <!-- Executions -->
                    <div class="p-4 space-y-2">
                        <div class="text-xs font-semibold text-slate-400">
                            <span x-transition class="text-sm" x-text="$store.labels.getLabel('header','lastseenexecutions')"></span>
                        </div>

                        <template x-for="exec in executions" :key="exec.href">
                            <a :href="exec.href"
                               class="flex !text-slate-300 items-start gap-2 px-2 py-1 rounded hover:bg-slate-700">
                            <span class="text-xs font-mono text-slate-400 w-10"
                                  x-text="exec.id"></span>

                                <div class="flex-1">
                                    <div class="text-sm" x-text="exec.name"></div>
                                    <div class="text-xs text-slate-400"
                                         x-text="exec.env"></div>
                                </div>

                                <span class="text-xs font-semibold px-2 py-0.5 rounded"
                                      :class="exec.status === 'OK'
                                    ? 'bg-green-500/20 text-green-400'
                                    : 'bg-red-500/20 text-red-400'"
                                      x-text="exec.status"></span>
                            </a>
                        </template>
                    </div>

                    <!-- Campaigns -->
                    <div class="p-4 space-y-2">
                        <div class="text-xs font-semibold text-slate-400">
                            <span x-transition class="text-sm" x-text="$store.labels.getLabel('header','lastseencampaigns')"></span>
                        </div>

                        <template x-for="camp in campaigns" :key="camp.href">
                            <a :href="camp.href"
                               class="block !text-slate-300 px-2 py-1 rounded hover:bg-slate-700"
                               x-text="camp.tag"></a>
                        </template>
                    </div>

                </div>
            </div>
        </template>
    </div>

    <!-- User Menu -->
    <div class="mt-auto sticky bottom-0 z-50 bg-slate-800/90 border-t border-slate-700"
         x-data="userMenu()" @click.outside="close()">

        <!-- Avatar / bouton user -->
        <div id="header_user_button" @click="userMenuOpen = !userMenuOpen" class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-slate-700/50 cursor-pointer transition-colors"
                 x-ref="userBtn">
                <div class="w-10 h-10 bg-gradient-to-r from-pink-400 to-red-400 rounded-full flex items-center justify-center">
                    <span class="text-white font-semibold text-sm" x-text="initials"></span>
                </div>
                <div x-show="$store.sidebar.expanded">
                    <p class="text-sm font-medium" x-text="username"></p>
                    <p class="text-xs text-slate-400" x-text="roleText"></p>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-auto transition-transform duration-200"
                     :class="userMenuOpen ? 'rotate-180' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                     x-show="$store.sidebar.expanded">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                </svg>
        </div>

        <!-- Dropdown téléporté dans le body -->
        <template x-teleport="body">
            <div x-show="userMenuOpen"
                 x-transition.opacity.duration.200ms
                 x-ref="navUserDropdown"
                 class="fixed w-72 h-[250px] rounded-md border border-slate-600 bg-slate-800 text-white shadow-lg overflow-auto z-50"
                 style="left:0; top:0;"
                 @click.outside="userMenuOpen = false"
                 @click.stop
                 x-init="
                        $watch('userMenuOpen', value => {
                            if (value) {
                                // On attend que le dropdown soit rendu et visible
                                requestAnimationFrame(() => {
                                    const btn = document.getElementById('header_user_button').getBoundingClientRect();
                                    const dropdown = $refs.navUserDropdown;
                                    if (!dropdown) return;

                                    const h = dropdown.offsetHeight;
                                    let top = btn.top - h - 1;
                                    if (top < 0) top = btn.bottom + 1;

                                    dropdown.style.left = btn.left + 'px';
                                    dropdown.style.top = top + 'px';
                                });
                            }
                        });
                     ">

                <ul class="py-2 text-sm space-y-1 px-2">

                    <!-- Logout -->
                    <li x-show="logoutHref" x-transition>
                        <a id="header_user_logout" :href="logoutHref"
                           class="block px-4 py-2 hover:bg-slate-700 text-red-600 rounded transition-colors">
                            --> Logout
                        </a>
                    </li>

                    <!-- Theme Switch -->
                    <li class="px-4 py-2">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-300 text-sm" x-text="$store.labels.getLabel('header','theme')"></span>
                            <div class="inline-flex rounded-full bg-slate-600 p-1 gap-1">
                                <button id="header_user_themelight_button"
                                        @click.stop="applyTheme('light')"
                                        :class="{'bg-slate-300 text-slate-800': $store.user.theme === 'light',
                                                    'bg-slate-600 text-gray-300': $store.user.theme !== 'light'}"
                                        class="p-2 rounded-full transition-colors flex items-center justify-center"
                                        aria-label="Light Theme">
                                    <!-- Icône Soleil (Lucide) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364-1.414-1.414M7.05 7.05 5.636 5.636m12.728 0-1.414 1.414M7.05 16.95l-1.414 1.414M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z" />
                                    </svg>
                                </button>
                                <button id="header_user_themedark_button" @click.stop="applyTheme('dark')"
                                        :class="{'bg-slate-300 text-slate-800': $store.user.theme === 'dark',
                                                'bg-slate-600 text-gray-300': $store.user.theme !== 'dark'}"
                                        class="p-2 rounded-full transition-colors flex items-center justify-center" aria-label="Dark Theme">
                                    <!-- Icône Lune (Lucide) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </li>

                    <!-- Language -->
                    <li class="px-4 py-2">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-300 text-sm" x-text="$store.labels.getLabel('header','lang')"></span>
                            <div class="inline-flex rounded-full bg-slate-600 p-1 gap-1">
                                <select x-model="$store.user.language" id="header_user_language" @change="changeLanguage($store.user.language)" class="bg-slate-700 text-slate-300 rounded px-2 py-1 text-xs">
                                    <option value="fr">FR</option>
                                    <option value="en">EN</option>
                                </select>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </template>
    </div>
</aside>
<div class="hidden ml-72 ml-20 w-72 w-20 dark:text-white"></div>